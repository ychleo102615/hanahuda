import{r as L,o as oe,F as de,G as re,d as H,H as ce,k as M,I as ae,J as V,y as i,z as s,K as U,C as k,_ as D,L as F,M as K,N as G,T as Z,O as ue,D as E,P as R,Q as A,R as a,S as O,U as W,A as e,E as X,V as N,B as m,W as j,X as Y,Y as ie,Z as fe,$ as se,a0 as ye,a1 as he,a2 as xe}from"./BKahYXLk.js";import{u as z,Z as J,a as ve,T as _e,A as be}from"./CNdY3Ly9.js";import{C as me,g as Ce,S as ge}from"./7br0AKhi.js";function Q(C,o={}){const{autoRegister:t=!0}=o,u=L(null),n=L(!1),g=()=>{u.value&&!n.value&&(re.register(C,u.value),n.value=!0)},r=()=>{n.value&&(re.unregister(C),n.value=!1)};return oe(()=>{t&&g()}),de(()=>{r()}),{elementRef:u,register:g,unregister:r,isRegistered:n}}const we=["data-card-id"],ke=H({__name:"CardComponent",props:{cardId:{},isSelectable:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},isHighlighted:{type:Boolean,default:!1},isFaceDown:{type:Boolean,default:!1},size:{default:"md"},isAnimationClone:{type:Boolean,default:!1},isPreviewHighlighted:{type:Boolean,default:!1},isSingleMatchHighlight:{type:Boolean,default:!1},isMultipleMatchHighlight:{type:Boolean,default:!1},enableShake:{type:Boolean,default:!1}},emits:["click"],setup(C,{emit:o}){const t=C,u=o,n=ce(),g=M(()=>!t.isAnimationClone&&n.isCardHidden(t.cardId)),r=M(()=>{if(t.isAnimationClone)return"h-full w-full";switch(t.size){case"sm":return"h-18 w-auto";case"lg":return"h-32 w-auto";default:return"h-24 w-auto"}}),l=M(()=>["inline-flex items-center justify-center rounded-md transition-shadow duration-200",{"cursor-pointer hover:drop-shadow-lg":t.isSelectable,"cursor-default":!t.isSelectable,"ring-2 ring-yellow-400 ring-offset-2 drop-shadow-lg":t.isSelected,"ring-2 ring-orange-400 ring-offset-1 drop-shadow-md animate-pulse-strong":t.isMultipleMatchHighlight&&!t.isSelected,"ring-2 ring-green-400 ring-offset-1 drop-shadow-md animate-pulse-soft":t.isSingleMatchHighlight&&!t.isMultipleMatchHighlight&&!t.isSelected,"ring-2 ring-green-400 ring-offset-1 drop-shadow-md":t.isHighlighted&&!t.isSingleMatchHighlight&&!t.isMultipleMatchHighlight&&!t.isSelected,"ring-2 ring-purple-400 ring-offset-1 drop-shadow-sm":t.isPreviewHighlighted&&!t.isHighlighted&&!t.isSingleMatchHighlight&&!t.isMultipleMatchHighlight&&!t.isSelected}]);function x(){t.isSelectable&&u("click",t.cardId)}const h=M(()=>t.isFaceDown?me:Ce(t.cardId)),p=L(null),{apply:f}=ae(p,{initial:{scale:1,y:0},hovered:{scale:1.05,y:-4,transition:{type:"spring",stiffness:400,damping:25}},selected:{scale:1.08,y:-6,transition:{type:"spring",stiffness:500,damping:20}},rest:{scale:1,y:0,transition:{type:"spring",stiffness:300,damping:30}}});function y(){t.isSelectable&&!t.isSelected&&f("hovered")}function c(){t.isSelected||f("rest")}return V(()=>t.isSelected,b=>{f(b?"selected":"rest")}),V(()=>t.enableShake,b=>{b&&p.value&&(p.value.classList.add("shake"),setTimeout(()=>{p.value?.classList.remove("shake")},500))}),(b,$)=>(s(),i("div",{ref_key:"cardRef",ref:p,class:U([l.value,{invisible:g.value}]),"data-card-id":C.isAnimationClone?void 0:C.cardId,onClick:x,onMouseenter:y,onMouseleave:c},[k(ge,{name:h.value,"class-name":r.value,"aria-label":`Card ${C.cardId}`},null,8,["name","class-name","aria-label"])],42,we))}}),q=D(ke,[["__scopeId","data-v-f01fc33a"]]),Me=H({__name:"FieldZone",setup(C){const o=F(),t=K(),{elementRef:u}=Q("field"),{fieldCards:n}=G(o),{previewHighlightedTargets:g,fieldCardSelectionMode:r,fieldCardSelectableTargets:l,fieldCardHighlightType:x,handCardConfirmationMode:h,matchableFieldCards:p,matchCount:f}=G(t),y=z(Z.SelectMatchTargetPort),c=z(Z.PlayHandCardPort);function b(_){return h.value||r.value?!1:g.value.includes(_)}function $(_){return r.value&&x.value==="single"?l.value.includes(_):h.value&&f.value===1?p.value.includes(_):!1}function I(_){return r.value&&x.value==="multiple"?l.value.includes(_):h.value&&f.value>1?p.value.includes(_):!1}function S(_){if(r.value&&l.value.includes(_)){const d=o.drawnCard,v=o.possibleTargetCardIds;if(!d||v.length===0){console.error("[FieldZone] Missing drawnCard or possibleTargets for AWAITING_SELECTION");return}y.execute({sourceCardId:d,targetCardId:_,possibleTargets:v}),t.exitFieldCardSelectionMode();return}if(h.value&&p.value.includes(_)){if(!t.handCardAwaitingConfirmation){console.warn("[FieldZone] No handCard awaiting confirmation");return}const d=t.handCardAwaitingConfirmation;console.info("[FieldZone] æ‰‹ç‰Œç¢ºèªæ¨¡å¼ - åŸ·è¡Œé…å°:",{selectedHandCard:d,fieldCard:_}),c.execute({cardId:d,handCards:o.myHandCards,fieldCards:o.fieldCards,targetCardId:_}),t.exitHandCardConfirmationMode();return}}return(_,d)=>(s(),i("div",{ref_key:"fieldRef",ref:u,class:"h-full flex items-center justify-center p-4"},[k(ue,{name:"field-cards",tag:"div",class:"grid grid-flow-col grid-rows-2 gap-4"},{default:E(()=>[(s(!0),i(R,null,A(a(n),v=>(s(),O(q,{key:v,"card-id":v,"is-selectable":a(r)&&a(l).includes(v)||a(h)&&a(p).includes(v),"is-preview-highlighted":b(v),"is-single-match-highlight":$(v),"is-multiple-match-highlight":I(v),size:"md",onClick:S},null,8,["card-id","is-selectable","is-preview-highlighted","is-single-match-highlight","is-multiple-match-highlight"]))),128))]),_:1})],512))}}),Se=D(Me,[["__scopeId","data-v-a621d96c"]]),Ie={key:1,class:"text-gray-500 text-sm"},$e=H({__name:"PlayerHandZone",emits:["cardSelect"],setup(C,{expose:o,emit:t}){const u=F(),n=K(),{elementRef:g}=Q("player-hand"),{myHandCards:r,isMyTurn:l,fieldCards:x}=G(u),{handCardAwaitingConfirmation:h}=G(n),p=z(Z.PlayHandCardPort),f=z(Z.DomainFacade),y=z(Z.AnimationPort),c=t;function b(w){if(!l.value||y.isAnimating())return;if(h.value!==w){const P=W(w);if(!P){console.warn("[PlayerHandZone] Card not found:",w);return}const pe=x.value.map(te=>W(te)).filter(te=>te!==void 0),le=f.findMatchableCards(P,pe).map(te=>te.card_id);n.enterHandCardConfirmationMode(w,le,le.length),c("cardSelect",w);return}const T=W(w);if(!T){console.warn("[PlayerHandZone] Card not found:",w);return}const B=x.value.map(P=>W(P)).filter(P=>P!==void 0),ne=f.findMatchableCards(T,B).map(P=>P.card_id);ne.length===0||ne.length===1?(p.execute({cardId:w,handCards:r.value,fieldCards:x.value}),n.exitHandCardConfirmationMode()):console.info("[PlayerHandZone] Multiple matches, please click field card")}function $(w){if(!l.value||y.isAnimating()||h.value===w)return;const T=W(w);if(!T)return;const B=x.value.map(P=>W(P)).filter(P=>P!==void 0),ne=f.findMatchableCards(T,B).map(P=>P.card_id);n.setHandCardHoverPreview(w,ne)}function I(){n.clearHandCardHoverPreview()}function S(w){return h.value===w}function _(){n.exitHandCardConfirmationMode()}V(l,w=>{!w&&n.handCardConfirmationMode&&n.exitHandCardConfirmationMode()});const{flowStage:d,possibleTargetCardIds:v}=G(u);return V(d,(w,T)=>{if(w==="AWAITING_SELECTION"&&v.value.length>0){const B=v.value[0]??"",ee=v.value.length===1?"single":"multiple";n.handCardConfirmationMode&&n.exitHandCardConfirmationMode(),n.enterFieldCardSelectionMode(B,v.value,ee),console.info("[PlayerHandZone] é€²å…¥å ´ç‰Œé¸æ“‡æ¨¡å¼:",{targets:v.value,highlightType:ee})}else T==="AWAITING_SELECTION"&&w!=="AWAITING_SELECTION"&&(n.exitFieldCardSelectionMode(),console.info("[PlayerHandZone] é›¢é–‹å ´ç‰Œé¸æ“‡æ¨¡å¼"))}),o({clearSelection:_}),(w,T)=>(s(),i("div",{ref_key:"handRef",ref:g,class:"h-full flex items-center justify-center p-4 overflow-x-auto"},[a(r).length>0?(s(),O(ue,{key:0,name:"hand-cards",tag:"div",class:"flex gap-3"},{default:E(()=>[(s(!0),i(R,null,A(a(r),B=>(s(),O(q,{key:B,"card-id":B,"is-selectable":a(l),"is-selected":S(B),size:"lg",onClick:b,onMouseenter:ee=>$(B),onMouseleave:I},null,8,["card-id","is-selectable","is-selected","onMouseenter"]))),128))]),_:1})):(s(),i("div",Ie," No cards "))],512))}}),Re=D($e,[["__scopeId","data-v-b5fc7271"]]),Ae={class:"flex gap-4 p-2 min-w-min h-full"},Te={class:"text-xs text-gray-400 mb-1 text-center"},He={key:0,class:"text-gray-500"},Pe={class:"flex gap-1 flex-wrap justify-center flex-1 items-center"},Ne=H({__name:"OpponentDepositoryZone",setup(C){const o=F(),{elementRef:t}=Q("opponent-depository"),u=M(()=>{const n=o.groupedOpponentDepository;return[{type:"BRIGHT",label:"å…‰",cards:n.BRIGHT},{type:"ANIMAL",label:"ç¨®",cards:n.ANIMAL},{type:"RIBBON",label:"çŸ­å†Š",cards:n.RIBBON},{type:"PLAIN",label:"ã‹ã™",cards:n.PLAIN}]});return(n,g)=>(s(),i("div",{ref_key:"depositoryRef",ref:t,class:"opponent-depository-zone w-full h-full overflow-x-auto"},[e("div",Ae,[(s(!0),i(R,null,A(u.value,r=>(s(),i("div",{key:r.type,class:"depository-group flex flex-col min-w-[60px]"},[e("div",Te,[X(m(r.label)+" ",1),r.cards.length>0?(s(),i("span",He,"("+m(r.cards.length)+")",1)):N("",!0)]),e("div",Pe,[(s(!0),i(R,null,A(r.cards,l=>(s(),O(q,{key:l,"card-id":l,"is-selectable":!1,"is-selected":!1,"is-highlighted":!1,size:"sm",class:"shrink-0"},null,8,["card-id"]))),128))])]))),128))])],512))}}),Oe=D(Ne,[["__scopeId","data-v-bc1bd4e3"]]),De={class:"flex gap-4 p-2 min-w-min h-full"},Be={class:"text-xs text-gray-400 mb-1 text-center"},Ge={key:0,class:"text-gray-500"},Ee={class:"flex gap-1 flex-wrap justify-center flex-1 items-center"},Le=H({__name:"PlayerDepositoryZone",setup(C){const o=F(),{elementRef:t}=Q("player-depository"),u=M(()=>{const n=o.groupedMyDepository;return[{type:"BRIGHT",label:"å…‰",cards:n.BRIGHT},{type:"ANIMAL",label:"ç¨®",cards:n.ANIMAL},{type:"RIBBON",label:"çŸ­å†Š",cards:n.RIBBON},{type:"PLAIN",label:"ã‹ã™",cards:n.PLAIN}]});return(n,g)=>(s(),i("div",{ref_key:"depositoryRef",ref:t,class:"player-depository-zone w-full h-full overflow-x-auto"},[e("div",De,[(s(!0),i(R,null,A(u.value,r=>(s(),i("div",{key:r.type,class:"depository-group flex flex-col min-w-[60px]"},[e("div",Be,[X(m(r.label)+" ",1),r.cards.length>0?(s(),i("span",Ge,"("+m(r.cards.length)+")",1)):N("",!0)]),e("div",Ee,[(s(!0),i(R,null,A(r.cards,l=>(s(),O(q,{key:l,"card-id":l,"is-selectable":!1,"is-selected":!1,"is-highlighted":!1,size:"sm",class:"shrink-0"},null,8,["card-id"]))),128))])]))),128))])],512))}}),Fe=D(Le,[["__scopeId","data-v-c6b3f960"]]),Ke={class:"relative w-16 h-24"},je={class:"mt-2 text-white text-sm font-medium bg-black/60 px-2 py-0.5 rounded"},Ze=H({__name:"DeckZone",setup(C){const o=F(),{deckRemaining:t,visualLayers:u}=G(o),{elementRef:n}=Q("deck"),g=M(()=>{const r=[];for(let l=0;l<u.value;l++)r.push({transform:`translate(0px, ${l*-2}px)`,zIndex:l});return r});return(r,l)=>(s(),i("div",{ref_key:"deckRef",ref:n,class:"relative flex flex-col items-center justify-center h-full p-2"},[e("div",Ke,[(s(!0),i(R,null,A(g.value,(x,h)=>(s(),i("div",{key:h,style:j(x),"data-testid":"deck-layer",class:"absolute inset-0"},[k(ge,{name:a(me),"class-name":"h-24 w-auto","aria-label":"Card back"},null,8,["name"])],4))),128))]),e("div",je,m(a(t)),1)],512))}}),ze={class:"w-full max-w-md rounded-lg bg-white p-6 shadow-2xl"},Ye={key:0,class:"mb-4 text-center"},Ve={class:"mb-6 space-y-2"},Ue={class:"font-medium text-gray-800"},We={class:"text-yellow-700"},Xe={class:"mb-6 rounded bg-gray-50 p-4"},qe={class:"mb-2 flex items-center justify-between"},Je={class:"text-xl font-bold text-gray-800"},Qe={key:0,class:"flex items-center justify-between"},et={class:"text-xl font-bold text-green-600"},tt=H({__name:"DecisionModal",setup(C){const o=K(),t=F(),{decisionModalVisible:u,decisionModalData:n,displayTimeoutRemaining:g}=G(o),{myDepository:r,myKoiKoiMultiplier:l}=G(t),x=z(Z.MakeKoiKoiDecisionPort),h=M(()=>g.value!==null&&g.value<=5?"text-red-500":"text-gray-800");function p(){n.value&&x.execute({currentYaku:n.value.currentYaku,depositoryCards:r.value,koiKoiMultiplier:l.value,decision:"KOI_KOI"}),o.hideDecisionModal()}function f(){n.value&&x.execute({currentYaku:n.value.currentYaku,depositoryCards:r.value,koiKoiMultiplier:l.value,decision:"END_ROUND"}),o.hideDecisionModal()}return(y,c)=>(s(),O(ie,{to:"body"},[k(Y,{name:"fade"},{default:E(()=>[a(u)&&a(n)?(s(),i("div",{key:0,class:"fixed inset-0 flex items-center justify-center bg-black/60",style:j({zIndex:a(J).MODAL})},[e("div",ze,[c[3]||(c[3]=e("h2",{class:"mb-4 text-center text-2xl font-bold text-yellow-600"}," Yaku Achieved! ",-1)),a(g)!==null?(s(),i("div",Ye,[c[0]||(c[0]=e("div",{class:"text-sm text-gray-600 mb-1"},"Time Remaining",-1)),e("div",{"data-testid":"decision-countdown",class:U(["text-3xl font-bold",h.value])},m(a(g)),3)])):N("",!0),e("div",Ve,[(s(!0),i(R,null,A(a(n).currentYaku,b=>(s(),i("div",{key:b.yaku_type,class:"flex items-center justify-between rounded bg-yellow-50 px-4 py-2"},[e("span",Ue,m(b.yaku_type),1),e("span",We,m(b.base_points)+" pts",1)]))),128))]),e("div",Xe,[e("div",qe,[c[1]||(c[1]=e("span",{class:"text-gray-600"},"Current Score:",-1)),e("span",Je,m(a(n).currentScore)+" pts ",1)]),a(n).potentialScore?(s(),i("div",Qe,[c[2]||(c[2]=e("span",{class:"text-gray-600"},"Potential Score:",-1)),e("span",et,m(a(n).potentialScore)+" pts ",1)])):N("",!0)]),c[4]||(c[4]=e("p",{class:"mb-6 text-center text-sm text-gray-600"},[X(' Choose "Koi-Koi" to continue and increase multiplier, but opponent may catch up. '),e("br"),X(' Choose "End Round" to get your current score immediately. ')],-1)),e("div",{class:"grid grid-cols-2 gap-4"},[e("button",{class:"rounded-lg bg-green-600 px-6 py-3 font-semibold text-white transition hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500",onClick:p}," Koi-Koi "),e("button",{class:"rounded-lg bg-red-600 px-6 py-3 font-semibold text-white transition hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",onClick:f}," End Round ")]),c[5]||(c[5]=e("p",{class:"mt-4 text-center text-xs text-gray-600"}," âš ï¸ If you choose Koi-Koi and opponent scores first, you lose all points ",-1))])],4)):N("",!0)]),_:1})]))}}),nt=D(tt,[["__scopeId","data-v-49f0f414"]]),st={key:0,class:"fixed top-4 right-4 z-50 flex items-center gap-3 bg-red-600 text-white px-6 py-4 rounded-lg shadow-lg max-w-md",role:"alert","aria-live":"assertive"},at={class:"flex-1"},ot={class:"text-sm font-medium"},it=H({__name:"ErrorToast",setup(C){const o=K();function t(){o.errorMessage=null}let u=null;return V(()=>o.errorMessage,n=>{u&&(clearTimeout(u),u=null),n&&(u=setTimeout(()=>{o.errorMessage=null},5e3))}),oe(()=>{console.info("[ErrorToast] Component mounted")}),(n,g)=>(s(),O(Y,{name:"toast-slide"},{default:E(()=>[a(o).errorMessage?(s(),i("div",st,[g[1]||(g[1]=e("svg",{class:"w-6 h-6 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",at,[e("p",ot,m(a(o).errorMessage),1)]),e("button",{type:"button",class:"flex-shrink-0 ml-4 text-white hover:text-red-100 transition-colors","aria-label":"Close error message",onClick:t},[...g[0]||(g[0]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):N("",!0)]),_:1}))}}),lt=D(it,[["__scopeId","data-v-78cccbf4"]]),rt={class:"bg-white rounded-lg shadow-2xl max-w-md w-full mx-4 overflow-hidden transform transition-all"},dt={id:"game-finished-title",class:"text-2xl font-bold text-center"},ct={class:"px-6 py-6 space-y-4"},ut={class:"text-center text-lg font-medium text-gray-800"},ft={class:"bg-gray-50 rounded-lg p-4 space-y-2"},mt={class:"text-gray-700 font-medium"},gt={key:0,class:"ml-2 text-xs text-green-600 font-bold"},pt=H({__name:"GameFinishedModal",setup(C){const o=K(),t=F(),u=fe();function n(l){return l===t.localPlayerId?"You":l===t.opponentPlayerId?"Opponent":l}function g(){o.hideGameFinishedModal()}function r(){o.hideGameFinishedModal(),t.$reset(),o.reset(),u.push("/")}return(l,x)=>(s(),O(Y,{name:"modal-fade"},{default:E(()=>[a(o).gameFinishedModalVisible&&a(o).gameFinishedModalData?(s(),i("div",{key:0,class:"fixed inset-0 flex items-center justify-center bg-black/60",role:"dialog","aria-modal":"true","aria-labelledby":"game-finished-title",style:j({zIndex:a(J).MODAL}),onClick:se(g,["self"])},[e("div",rt,[e("div",{class:U(["px-6 py-5 text-white",a(o).gameFinishedModalData.isPlayerWinner?"bg-gradient-to-r from-green-500 to-green-600":"bg-gradient-to-r from-blue-500 to-blue-600"])},[e("h2",dt,m(a(o).gameFinishedModalData.isPlayerWinner?"ðŸŽ‰ Victory!":"Game Over"),1)],2),e("div",ct,[e("p",ut,m(a(o).gameFinishedModalData.isPlayerWinner?"Congratulations! You won the game!":`Player ${n(a(o).gameFinishedModalData.winnerId)} won the game.`),1),e("div",ft,[x[0]||(x[0]=e("h3",{class:"text-sm font-semibold text-gray-700 mb-3"}," Final Scores ",-1)),(s(!0),i(R,null,A(a(o).gameFinishedModalData.finalScores,h=>(s(),i("div",{key:h.player_id,class:"flex items-center justify-between py-2 border-b border-gray-200 last:border-0"},[e("span",mt,[X(m(n(h.player_id))+" ",1),h.player_id===a(o).gameFinishedModalData.winnerId?(s(),i("span",gt," ðŸ‘‘ Winner ")):N("",!0)]),e("span",{class:U(["text-xl font-bold",h.player_id===a(o).gameFinishedModalData.winnerId?"text-green-600":"text-gray-600"])},m(h.score),3)]))),128))])]),e("div",{class:"px-6 py-4 bg-gray-50 flex gap-3 justify-end"},[e("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium",onClick:g}," Close "),e("button",{type:"button",class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",onClick:r}," New Game ")])])],4)):N("",!0)]),_:1}))}}),yt=D(pt,[["__scopeId","data-v-1ff88b3c"]]),ht={id:"round-end-title",class:"text-2xl font-bold text-center"},xt={class:"px-6 py-6 space-y-4"},vt={key:0,class:"text-center"},_t={class:"bg-gray-50 rounded-lg p-4 space-y-2"},bt={class:"text-gray-700 font-medium"},Ct={class:"text-xl font-bold text-gray-600"},wt={key:1,class:"text-center"},kt={class:"text-lg font-medium text-gray-800 mb-4"},Mt={class:"bg-yellow-50 rounded-lg p-4 mb-4"},St={class:"space-y-2"},It={class:"text-gray-700 font-medium"},$t={class:"text-lg font-bold text-yellow-700"},Rt={class:"bg-gray-50 rounded-lg p-4 space-y-2"},At={class:"flex items-center justify-between py-1"},Tt={class:"text-lg font-semibold text-gray-700"},Ht={class:"flex items-center justify-between py-1"},Pt={class:"text-lg font-semibold text-gray-700"},Nt={class:"flex items-center justify-between py-2 border-t-2 border-gray-300"},Ot={class:"text-2xl font-bold text-yellow-600"},Dt={class:"bg-gray-50 rounded-lg p-4 mt-4"},Bt={class:"text-gray-700 font-medium"},Gt={class:"text-xl font-bold text-gray-600"},Et={key:2,class:"text-center"},Lt={class:"text-lg font-medium text-gray-800 mb-4"},Ft={key:0,class:"bg-blue-50 rounded-lg p-4 mb-4"},Kt={class:"text-base text-gray-700 mb-2"},jt={class:"font-bold text-blue-700"},Zt={class:"font-bold text-blue-700"},zt={class:"bg-gray-50 rounded-lg p-4"},Yt={class:"text-gray-700 font-medium"},Vt={class:"text-xl font-bold text-gray-600"},Ut={key:3,class:"text-center text-gray-600"},Wt={class:"px-6 py-4 bg-gray-50 border-t border-gray-200"},Xt={class:"flex items-center justify-center gap-2 text-gray-700"},qt=H({__name:"RoundEndModal",setup(C){const o=K(),t=F(),{displayTimeoutRemaining:u,roundDrawnModalVisible:n,roundScoredModalVisible:g,roundEndedInstantlyModalVisible:r,roundScoredModalData:l,roundEndedInstantlyModalData:x}=G(o),h=M(()=>n.value?"roundDrawn":g.value?"roundScored":r.value?"roundEndedInstantly":null),p=M(()=>h.value!==null&&u.value!==null),f=M(()=>u.value??0),y=M(()=>{switch(h.value){case"roundScored":return"bg-gradient-to-r from-yellow-500 to-yellow-600";case"roundEndedInstantly":return"bg-gradient-to-r from-blue-500 to-blue-600";case"roundDrawn":return"bg-gradient-to-r from-gray-500 to-gray-600";default:return"bg-gradient-to-r from-gray-500 to-gray-600"}}),c=M(()=>{switch(h.value){case"roundScored":return"Round Complete";case"roundEndedInstantly":return"Round Ended";case"roundDrawn":return"Round Draw";default:return"Round End"}}),b=M(()=>(u.value??0)<5?"text-red-500":"text-gray-800");function $(_){return{INOU_SHIKO:"Boar-Deer-Butterfly",KASU:"Plain Cards",TANZAKU:"Ribbons",TANE:"Animals",AKATAN:"Red Ribbons",AOTAN:"Blue Ribbons",SANKO:"Three Brights",SHIKOU:"Four Brights",GOKOU:"Five Brights",TSUKIMI_ZAKE:"Moon Viewing",HANAMI_ZAKE:"Flower Viewing"}[_]||_}function I(_){return{TESHI:"Hand Yaku (Teshi)",FIELD_KUTTSUKI:"Field Four-of-a-Kind",NO_YAKU:"No Yaku Formed"}[_]||_}function S(_){const d=t.getLocalPlayerId();return _===d?"You":"Opponent"}return(_,d)=>(s(),O(Y,{name:"modal-fade"},{default:E(()=>[p.value?(s(),i("div",{key:0,class:"fixed inset-0 flex items-center justify-center bg-black/60",role:"dialog","aria-modal":"true","aria-labelledby":"round-end-title",style:j({zIndex:a(J).MODAL}),onClick:d[1]||(d[1]=se(()=>{},["prevent"])),onKeydown:d[2]||(d[2]=ye(se(()=>{},["prevent"]),["esc"]))},[e("div",{class:"bg-white rounded-lg shadow-2xl max-w-md w-full mx-4 overflow-hidden transform transition-all",onClick:d[0]||(d[0]=se(()=>{},["stop"]))},[e("div",{class:U(["px-6 py-5 text-white",y.value])},[e("h2",ht,m(c.value),1)],2),e("div",xt,[h.value==="roundDrawn"?(s(),i("div",vt,[d[4]||(d[4]=e("p",{class:"text-lg font-medium text-gray-800 mb-4"}," å¼•ãåˆ†ã‘ (Draw) ",-1)),e("div",_t,[d[3]||(d[3]=e("h3",{class:"text-sm font-semibold text-gray-700 mb-3"}," Current Scores ",-1)),(s(!0),i(R,null,A(a(o).roundDrawnModalScores,v=>(s(),i("div",{key:v.player_id,class:"flex items-center justify-between py-2 border-b border-gray-200 last:border-0"},[e("span",bt,m(S(v.player_id)),1),e("span",Ct,m(v.score),1)]))),128))])])):h.value==="roundScored"&&a(l)?(s(),i("div",wt,[e("p",kt,m(S(a(l).winnerId))+" won this round! ",1),e("div",Mt,[d[5]||(d[5]=e("h3",{class:"text-sm font-semibold text-yellow-800 mb-3"},"Yaku Achieved",-1)),e("div",St,[(s(!0),i(R,null,A(a(l).yakuList,v=>(s(),i("div",{key:v.yaku_type,class:"flex items-center justify-between py-2 border-b border-yellow-200 last:border-0"},[e("span",It,m($(v.yaku_type)),1),e("span",$t,m(v.base_points)+" pts",1)]))),128))])]),e("div",Rt,[e("div",At,[d[6]||(d[6]=e("span",{class:"text-sm text-gray-600"},"Base Score:",-1)),e("span",Tt,m(a(l).baseScore),1)]),e("div",Ht,[d[7]||(d[7]=e("span",{class:"text-sm text-gray-600"},"Multiplier:",-1)),e("span",Pt,"Ã—"+m(a(l).multipliers.player_multipliers[a(l).winnerId]),1)]),e("div",Nt,[d[8]||(d[8]=e("span",{class:"text-base font-bold text-gray-800"},"Final Score:",-1)),e("span",Ot,m(a(l).finalScore),1)])]),e("div",Dt,[d[9]||(d[9]=e("h3",{class:"text-sm font-semibold text-gray-700 mb-3"},"Total Scores",-1)),(s(!0),i(R,null,A(a(l).updatedTotalScores,v=>(s(),i("div",{key:v.player_id,class:"flex items-center justify-between py-2 border-b border-gray-200 last:border-0"},[e("span",Bt,m(S(v.player_id)),1),e("span",Gt,m(v.score),1)]))),128))])])):h.value==="roundEndedInstantly"&&a(x)?(s(),i("div",Et,[e("p",Lt,m(I(a(x).reason)),1),a(x).winnerId?(s(),i("div",Ft,[e("p",Kt,[e("span",jt,m(S(a(x).winnerId)),1),d[10]||(d[10]=X(" received ",-1)),e("span",Zt,m(a(x).awardedPoints)+" points",1)])])):N("",!0),e("div",zt,[d[11]||(d[11]=e("h3",{class:"text-sm font-semibold text-gray-700 mb-3"},"Total Scores",-1)),(s(!0),i(R,null,A(a(x).updatedTotalScores,v=>(s(),i("div",{key:v.player_id,class:"flex items-center justify-between py-2 border-b border-gray-200 last:border-0"},[e("span",Yt,m(S(v.player_id)),1),e("span",Vt,m(v.score),1)]))),128))])])):(s(),i("div",Ut,[...d[12]||(d[12]=[e("p",null,"Round ended",-1)])]))]),e("div",Wt,[e("div",Xt,[d[13]||(d[13]=e("span",{class:"text-sm font-medium"},"Next round in:",-1)),e("span",{class:U(["text-2xl font-bold tabular-nums",b.value])},m(f.value),3),d[14]||(d[14]=e("span",{class:"text-sm"},"s",-1))]),d[15]||(d[15]=e("p",{class:"text-xs text-gray-500 text-center mt-2"}," Please wait for the countdown to finish ",-1))])])],36)):N("",!0)]),_:1}))}}),Jt=D(qt,[["__scopeId","data-v-65df56ec"]]),Qt={key:0,class:"reconnection-banner",role:"alert","aria-live":"polite"},en={class:"banner-content"},tn={class:"status-message"},nn=H({__name:"ReconnectionBanner",setup(C){he(n=>({c3370b10:a(J).RECONNECTION}));const o=K(),t=M(()=>o.reconnecting||o.connectionStatus==="connecting"),u=M(()=>o.reconnecting?"é€£ç·šä¸­æ–·ï¼Œæ­£åœ¨å˜—è©¦é‡é€£...":o.connectionStatus==="connecting"?"æ­£åœ¨é€£ç·š...":"");return(n,g)=>(s(),O(Y,{name:"slide-down"},{default:E(()=>[t.value?(s(),i("div",Qt,[e("div",en,[g[0]||(g[0]=e("span",{class:"loading-spinner","aria-hidden":"true"},null,-1)),e("span",tn,m(u.value),1)])])):N("",!0)]),_:1}))}}),sn=D(nn,[["__scopeId","data-v-b87a223c"]]),an=H({__name:"AnimationLayer",setup(C){const o=ce(),t=L(new Set),u=L(new Map),n=L(new Set),g=L(new Map);function r(p,f){f?(u.value.set(p,f),l(p)):u.value.delete(p)}function l(p){if(t.value.has(p))return;const f=o.animatingCards.find(I=>I.cardId===p);if(!f)return;const y=u.value.get(p);if(!y)return;t.value.add(p);const c=f.cardEffectType||"deal";y.style.transformOrigin="0 0";let b;if(c==="pulse")b={initial:{scale:1,opacity:1},enter:{scale:[1,1.15,1],opacity:1,transition:{duration:300,ease:"easeInOut"}}};else if(c==="fadeOut")b={initial:{opacity:1},enter:{opacity:0,transition:{duration:250,ease:"easeOut"}}};else if(c==="fadeIn")b={initial:{opacity:0},enter:{opacity:1,transition:{duration:250,ease:"easeIn"}}};else{const I=f.toRect.width/f.fromRect.width,S=f.toRect.x-f.fromRect.x,_=f.toRect.y-f.fromRect.y;b={initial:{x:0,y:0,scale:1,opacity:c==="move"?1:0},enter:{x:S,y:_,scale:I,opacity:1,transition:{type:"spring",stiffness:300,damping:25}}}}const{apply:$}=ae(y,b);$("enter")?.then(()=>{f.onComplete(),o.removeCard(f.cardId),t.value.delete(p)})}function x(p,f){f?(g.value.set(p,f),h(p)):g.value.delete(p)}function h(p){if(n.value.has(p))return;const f=o.animatingGroups.find(I=>I.groupId===p);if(!f)return;const y=g.value.get(p);if(!y)return;n.value.add(p);const c=f.groupEffectType;let b;c==="pulse"?b={initial:{scale:1,opacity:1},enter:{scale:[1,1.15,1],opacity:1,transition:{duration:300,ease:"easeInOut"}}}:c==="fadeOut"?b={initial:{opacity:1},enter:{opacity:0,transition:{duration:250,ease:"easeOut"}}}:c==="fadeIn"?b={initial:{opacity:0},enter:{opacity:1,transition:{duration:250,ease:"easeIn"}}}:b={initial:{opacity:1},enter:{opacity:1}};const{apply:$}=ae(y,b);$("enter")?.then(()=>{f.onComplete(),o.removeGroup(f.groupId),n.value.delete(p)})}return(p,f)=>(s(),O(ie,{to:"body"},[e("div",{class:"fixed inset-0 pointer-events-none",style:j({zIndex:a(J).ANIMATION})},[(s(!0),i(R,null,A(a(o).animatingCards,y=>(s(),i("div",{key:y.cardId,ref_for:!0,ref:c=>r(y.cardId,c),class:"absolute",style:j({left:`${y.fromRect.x}px`,top:`${y.fromRect.y}px`,width:`${y.fromRect.width}px`,height:`${y.fromRect.height}px`})},[k(q,{"card-id":y.renderCardId||y.cardId,"is-animation-clone":!0,"is-face-down":y.isFaceDown},null,8,["card-id","is-face-down"])],4))),128)),(s(!0),i(R,null,A(a(o).animatingGroups,y=>(s(),i("div",{key:y.groupId,ref_for:!0,ref:c=>x(y.groupId,c),class:"absolute",style:j({left:`${y.boundingBox.x}px`,top:`${y.boundingBox.y}px`,width:`${y.boundingBox.width}px`,height:`${y.boundingBox.height}px`})},[(s(!0),i(R,null,A(y.cards,c=>(s(),i("div",{key:c.cardId,class:"absolute",style:j({left:`${c.fromRect.x-y.boundingBox.x}px`,top:`${c.fromRect.y-y.boundingBox.y}px`,width:`${c.fromRect.width}px`,height:`${c.fromRect.height}px`})},[k(q,{"card-id":c.renderCardId||c.cardId,"is-animation-clone":!0,"is-face-down":c.isFaceDown},null,8,["card-id","is-face-down"])],4))),128))],4))),128))],4)]))}}),on={key:0,class:"fixed bottom-8 left-1/2 -translate-x-1/2 z-50"},ln={class:"px-6 py-3 bg-gray-800 bg-opacity-90 text-white text-sm font-medium rounded-lg shadow-lg"},rn=H({__name:"ConfirmationHint",setup(C){const o=K(),{handCardConfirmationMode:t,matchCount:u}=G(o),n=M(()=>{if(!t.value)return"";switch(u.value){case 0:return"Click to play card";case 1:return"Click card again or click field card to play";default:return"Click highlighted field card to select match"}}),g=M(()=>t.value&&n.value!=="");return(r,l)=>(s(),O(Y,{name:"hint"},{default:E(()=>[g.value?(s(),i("div",on,[e("div",ln,m(n.value),1)])):N("",!0)]),_:1}))}}),dn=D(rn,[["__scopeId","data-v-4cee72e9"]]),cn=["aria-labelledby"],un={"data-testid":"dialog-title",class:"mb-4 text-xl font-bold text-gray-900"},fn={"data-testid":"dialog-message",class:"mb-6 text-base text-gray-700"},mn={class:"flex justify-end space-x-3"},gn=H({__name:"ConfirmDialog",props:{isOpen:{type:Boolean},title:{},message:{},confirmText:{default:"ç¢ºèª"},cancelText:{default:"å–æ¶ˆ"}},emits:["confirm","cancel"],setup(C,{emit:o}){const t=C,u=o,n=L(),g=()=>{n.value&&ae(n.value,{initial:{scale:.95,opacity:0},enter:{scale:1,opacity:1,transition:{type:"spring",stiffness:300,damping:25}},leave:{scale:.95,opacity:0,transition:{duration:150}}})};V(()=>t.isOpen,x=>{x&&g()},{immediate:!0});const r=()=>{u("confirm")},l=()=>{u("cancel")};return V(()=>t.isOpen,x=>{x?document.body.style.overflow="hidden":document.body.style.overflow=""},{immediate:!0}),(x,h)=>(s(),O(ie,{to:"body"},[k(Y,{name:"fade"},{default:E(()=>[C.isOpen?(s(),i("div",{key:0,"data-testid":"confirm-dialog-overlay",class:"fixed inset-0 flex items-center justify-center",style:j({zIndex:a(J).MODAL})},[e("div",{class:"absolute inset-0 bg-black bg-opacity-50 transition-opacity",onClick:l}),e("div",{ref_key:"dialogRef",ref:n,"data-testid":"confirm-dialog",role:"dialog","aria-modal":"true","aria-labelledby":C.title,class:"relative z-10 w-full max-w-md rounded-lg bg-white p-6 shadow-2xl"},[e("h2",un,m(C.title),1),e("p",fn,m(C.message),1),e("div",mn,[e("button",{"data-testid":"cancel-button",type:"button",class:"rounded-lg bg-gray-200 px-4 py-2 text-sm font-medium text-gray-900 hover:bg-gray-300 transition-colors",onClick:l},m(C.cancelText),1),e("button",{"data-testid":"confirm-button",type:"button",class:"rounded-lg bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700 transition-colors",onClick:r},m(C.confirmText),1)])],8,cn)],4)):N("",!0)]),_:1})]))}}),pn=Object.assign(D(gn,[["__scopeId","data-v-986e4c68"]]),{__name:"ConfirmDialog"});function yn(C={}){const{requireConfirmation:o=!1}=C,t=fe(),u=F(),n=K(),g=xe(),r=z(Z.SendCommandPort),l=z(Z.NotificationPort),x=L(!1),h=L(!1),p=[{id:"leave-game",label:"Leave Game",icon:"ðŸšª",onClick:c}];function f(){x.value=!x.value}function y(){x.value=!1}function c(){o?h.value=!0:b()}async function b(){try{h.value=!1,x.value=!1;const S=u.gameId;if(!S){console.warn("[useLeaveGame] ç„¡æ³•é€€å‡ºéŠæˆ²ï¼šæ‰¾ä¸åˆ° gameId"),I();return}if(r)try{await r.leaveGame(S),console.info("[useLeaveGame] æˆåŠŸèª¿ç”¨ leaveGame API")}catch(_){console.error("[useLeaveGame] leaveGame API å¤±æ•—:",_)}else console.warn("[useLeaveGame] GameApiClient æœªæ³¨å…¥");I()}catch(S){console.error("[useLeaveGame] é€€å‡ºéŠæˆ²æµç¨‹å¤±æ•—:",S),I()}}function $(){h.value=!1}function I(){sessionStorage.removeItem("session_token"),l.cleanup(),u.$reset(),n.$reset(),g.$reset(),t.push("/")}return{isActionPanelOpen:x,isConfirmDialogOpen:h,menuItems:p,toggleActionPanel:f,closeActionPanel:y,handleLeaveGameClick:c,handleLeaveGameConfirm:b,handleLeaveGameCancel:$}}const hn={class:"h-screen w-screen flex flex-col bg-green-900 overflow-hidden"},xn={class:"h-[10%] min-h-12 relative"},vn={class:"flex items-center gap-4"},_n={class:"text-center"},bn={class:"text-xl font-bold"},Cn={class:"h-[15%] bg-gray-700/50 overflow-x-auto"},wn={class:"h-[30%] bg-green-800/50 flex"},kn={class:"h-[15%] bg-gray-700/50 overflow-x-auto"},Mn={class:"h-[30%] bg-gray-800/50"},Sn={class:"fixed top-20 left-4 bg-black/70 text-white px-3 py-1 rounded text-sm"},In={key:0,class:"fixed bottom-4 left-1/2 -translate-x-1/2 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg"},$n=H({__name:"game",setup(C){const{elementRef:o}=Q("opponent-hand"),t=F(),u=K(),{opponentHandCount:n,fieldCards:g}=G(t),{infoMessage:r,handCardConfirmationMode:l,handCardAwaitingConfirmation:x,connectionStatus:h}=G(u),p=M(()=>{switch(h.value){case"connected":return"Connected";case"connecting":return"Connecting...";case"disconnected":return"Disconnected";default:return""}}),f=M(()=>{switch(h.value){case"connected":return"text-green-400";case"connecting":return"text-yellow-400";case"disconnected":return"text-red-400";default:return""}}),{isActionPanelOpen:y,isConfirmDialogOpen:c,menuItems:b,toggleActionPanel:$,closeActionPanel:I,handleLeaveGameConfirm:S,handleLeaveGameCancel:_}=yn({requireConfirmation:!0}),d=sessionStorage.getItem("gameMode")||"mock";oe(()=>{console.info("[GamePage] éŠæˆ²é é¢å·²è¼‰å…¥",{gameMode:d,gameId:t.gameId})}),de(()=>{const w=ve(Z.MockEventEmitter);w&&(console.info("[GamePage] é‡ç½® Mock äº‹ä»¶ç™¼å°„å™¨"),w.reset())});function v(w){console.info("[GamePage] å ´ç‰Œé»žæ“Šäº‹ä»¶ï¼ˆå·²ç”± FieldZone è™•ç†ï¼‰:",w)}return(w,T)=>(s(),i("div",hn,[e("div",{ref_key:"opponentHandRef",ref:o,class:"fixed w-full h-24",style:{top:"-150px",left:"0"},"aria-hidden":"true"},null,512),e("header",xn,[k(_e,{variant:"game",onMenuClick:a($)},{right:E(()=>[e("div",vn,[e("div",_n,[T[1]||(T[1]=e("div",{class:"text-xs text-gray-400"},"You",-1)),e("div",bn,m(a(t).myScore),1)]),e("div",{class:U(["text-xs",f.value])},m(p.value),3),e("button",{"data-testid":"menu-button","aria-label":"Open menu",class:"p-2 rounded-lg hover:bg-white/10 transition-colors",onClick:T[0]||(T[0]=(...B)=>a($)&&a($)(...B))},[...T[2]||(T[2]=[e("svg",{class:"h-6 w-6 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1)])])])]),_:1},8,["onMenuClick"])]),e("section",Cn,[k(Oe)]),e("section",wn,[k(Se,{class:"flex-1",onCardClick:v}),k(Ze,{class:"w-24 shrink-0"})]),e("section",kn,[k(Fe)]),e("section",Mn,[k(Re)]),e("div",Sn," Opponent Hand: "+m(a(n)),1),k(lt),k(Y,{name:"fade"},{default:E(()=>[a(r)?(s(),i("div",In,m(a(r)),1)):N("",!0)]),_:1}),k(sn),k(nt),k(yt),k(Jt),k(an),k(dn),k(be,{"is-open":a(y),items:a(b),onClose:a(I)},null,8,["is-open","items","onClose"]),k(pn,{"is-open":a(c),title:"Leave Game",message:"Are you sure you want to leave this game? Your progress will be lost.","confirm-text":"Leave","cancel-text":"Cancel",onConfirm:a(S),onCancel:a(_)},null,8,["is-open","onConfirm","onCancel"])]))}}),Pn=D($n,[["__scopeId","data-v-b9415c95"]]);export{Pn as default};
