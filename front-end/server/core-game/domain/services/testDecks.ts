/**
 * Test Decks - Domain Service
 *
 * @description
 * 特殊規則測試用牌組。
 * 提供模擬手四、喰付、場上手四等開局特殊情況的固定牌組。
 *
 * 發牌順序：
 * - index 0-7: 玩家1 手牌
 * - index 8-15: 玩家2 手牌
 * - index 16-23: 場牌
 * - index 24-47: 剩餘牌堆
 *
 * @module server/domain/services/testDecks
 */

/**
 * 測試用牌組類型
 */
export type TestDeckType =
  | 'triple_match'
  | 'teshi'
  | 'kuttsuki'
  | 'field_teshi'
  | 'yaku_before_selection'

/**
 * 測試用牌組 - 對手翻牌雙配對測試
 *
 * @description
 * 測試場景：
 * - 玩家1 翻牌堆第 1 張 (index 24 = '0642')，與場上 '0641' 配對
 * - 對手翻牌堆第 1 張 (index 25 = '0341')，場上有兩張 3 月牌可配對
 */
const TEST_DECK_TRIPLE_MATCH: readonly string[] = Object.freeze([
  // 玩家1 手牌 (8張) - index 0-7
  '0142', // 1月かす2
  '0221', // 2月
  '0231', // 2月
  '0731', // 7月
  '0421', // 4月
  '0521', // 5月
  '0621', // 6月
  '0721', // 7月

  // 玩家2 手牌 (8張) - index 8-15
  '0241', // 2月
  '0242', // 2月
  '0431', // 4月
  '0441', // 4月
  '0531', // 5月
  '0541', // 5月
  '0631', // 6月
  '0741', // 7月

  // 場牌 (8張) - index 16-23
  '0111', // 1月
  '0131', // 1月
  '0141', // 1月
  '0311', // 3月 (雙配對目標 1)
  '0331', // 3月 (雙配對目標 2)
  '0442', // 4月
  '0542', // 5月
  '0641', // 6月

  // 剩餘牌堆 (24張) - index 24-47
  '0642', // 6月 - 玩家1翻，與場上 0641 配對
  '0341', // 3月 - 對手翻，場上有 0311, 0331 兩張可配對
  '0342', // 3月
  '0742', // 7月
  '0811', // 8月
  '0821', // 8月
  '0841', // 8月
  '0842', // 8月
  '0921', // 9月
  '0931', // 9月
  '0941', // 9月
  '0942', // 9月
  '1021', // 10月
  '1031', // 10月
  '1041', // 10月
  '1042', // 10月
  '1111', // 11月
  '1121', // 11月
  '1131', // 11月
  '1141', // 11月
  '1211', // 12月
  '1241', // 12月
  '1242', // 12月
  '1243', // 12月
])

/**
 * 測試用牌組 - 手四 (Teshi)
 *
 * @description
 * 玩家1 手牌有 1 月的 4 張牌，觸發手四。
 * 手四結果：玩家1 獲得 6 分，該局結束。
 */
const TEST_DECK_TESHI: readonly string[] = Object.freeze([
  // 玩家1 手牌 (8張) - 1 月 4 張 → 觸發手四
  '0111', // 1月光牌（松鶴）
  '0131', // 1月短冊（松赤短）
  '0141', // 1月かす1
  '0142', // 1月かす2
  '0221', // 2月種牌
  '0231', // 2月短冊
  '0241', // 2月かす1
  '0242', // 2月かす2

  // 玩家2 手牌 (8張)
  '0311', // 3月光牌
  '0331', // 3月短冊
  '0341', // 3月かす1
  '0342', // 3月かす2
  '0421', // 4月種牌
  '0431', // 4月短冊
  '0441', // 4月かす1
  '0442', // 4月かす2

  // 場牌 (8張)
  '0521', // 5月種牌
  '0531', // 5月短冊
  '0541', // 5月かす1
  '0542', // 5月かす2
  '0621', // 6月種牌
  '0631', // 6月青短
  '0641', // 6月かす1
  '0642', // 6月かす2

  // 剩餘牌堆 (24張)
  '0721', '0731', '0741', '0742',
  '0811', '0821', '0841', '0842',
  '0921', '0931', '0941', '0942',
  '1021', '1031', '1041', '1042',
  '1111', '1121', '1131', '1141',
  '1211', '1241', '1242', '1243',
])

/**
 * 測試用牌組 - 喰付 (Kuttsuki)
 *
 * @description
 * 玩家1 手牌有 4 對同月份的牌（8 張都成對），觸發喰付。
 * 喰付結果：玩家1 獲得 6 分，該局結束。
 *
 * 手牌組成：
 * - 1 月 2 張: 0111, 0131
 * - 2 月 2 張: 0221, 0231
 * - 3 月 2 張: 0311, 0331
 * - 4 月 2 張: 0421, 0431
 */
const TEST_DECK_KUTTSUKI: readonly string[] = Object.freeze([
  // 玩家1 手牌 (8張) - 4 對同月份 → 觸發喰付
  '0111', // 1月光牌
  '0131', // 1月短冊
  '0221', // 2月種牌
  '0231', // 2月短冊
  '0311', // 3月光牌
  '0331', // 3月短冊
  '0421', // 4月種牌
  '0431', // 4月短冊

  // 玩家2 手牌 (8張)
  '0141', // 1月かす1
  '0142', // 1月かす2
  '0241', // 2月かす1
  '0242', // 2月かす2
  '0341', // 3月かす1
  '0342', // 3月かす2
  '0441', // 4月かす1
  '0442', // 4月かす2

  // 場牌 (8張)
  '0521', // 5月種牌
  '0531', // 5月短冊
  '0541', // 5月かす1
  '0542', // 5月かす2
  '0621', // 6月種牌
  '0631', // 6月青短
  '0641', // 6月かす1
  '0642', // 6月かす2

  // 剩餘牌堆 (24張)
  '0721', '0731', '0741', '0742',
  '0811', '0821', '0841', '0842',
  '0921', '0931', '0941', '0942',
  '1021', '1031', '1041', '1042',
  '1111', '1121', '1131', '1141',
  '1211', '1241', '1242', '1243',
])

/**
 * 測試用牌組 - 場上手四 (Field Teshi)
 *
 * @description
 * 場牌有 1 月的 4 張牌，觸發場上手四。
 * 場上手四結果：流局重發，無人獲分。
 */
const TEST_DECK_FIELD_TESHI: readonly string[] = Object.freeze([
  // 玩家1 手牌 (8張)
  '0221', // 2月種牌
  '0231', // 2月短冊
  '0241', // 2月かす1
  '0442', // 4月かす2
  '0311', // 3月光牌
  '0331', // 3月短冊
  '0341', // 3月かす1
  '0542', // 5月かす2

  // 玩家2 手牌 (8張)
  '0421', // 4月種牌
  '0431', // 4月短冊
  '0441', // 4月かす1
  '0242', // 2月かす2
  '0521', // 5月種牌
  '0531', // 5月短冊
  '0541', // 5月かす1
  '0342', // 3月かす2

  // 場牌 (8張) - 1 月 4 張 → 觸發場上手四
  '0111', // 1月光牌（松鶴）
  '0131', // 1月短冊（松赤短）
  '0141', // 1月かす1
  '0142', // 1月かす2
  '0621', // 6月種牌
  '0631', // 6月青短
  '0641', // 6月かす1
  '0642', // 6月かす2

  // 剩餘牌堆 (24張)
  '0721', '0731', '0741', '0742',
  '0811', '0821', '0841', '0842',
  '0921', '0931', '0941', '0942',
  '1021', '1031', '1041', '1042',
  '1111', '1121', '1131', '1141',
  '1211', '1241', '1242', '1243',
])

/**
 * 測試用牌組 - 手牌階段形成役種 + 翻牌雙配對
 *
 * @description
 * 測試場景（Bug 修復驗證）：
 * - 第 1 回合：玩家1 打 0921（菊盃），與場上 0941 單配對，獲得菊盃
 * - 第 1 回合翻牌：0942 放到場上（無配對）
 * - 對手回合：打牌、翻牌
 * - 第 2 回合：玩家1 打 0311（櫻幕），與場上 0341 單配對
 *   → 獲得區有菊盃+櫻幕 = 花見酒形成（手牌階段）
 * - 第 2 回合翻牌：0431（4月短冊），場上有 0441, 0442 兩張 4 月牌
 *   → 觸發 selectionRequired
 * - 玩家選擇配對目標後
 *   → 應觸發 DecisionRequired（因為花見酒已在手牌階段形成）
 *
 * 此測試驗證修復：手牌階段形成的役種在翻牌雙配對後仍能正確觸發 DecisionRequired
 * 對應 Bug：selectTargetUseCase 中 previousYaku 基準點錯誤
 */
const TEST_DECK_YAKU_BEFORE_SELECTION: readonly string[] = Object.freeze([
  // 玩家1 手牌 (8張) - index 0-7
  '0921', // 9月菊盃 - 第 1 回合打，與場上 0941 配對
  '0311', // 3月櫻幕 - 第 2 回合打，與場上 0341 配對，形成花見酒
  '0111', // 1月光牌
  '0221', // 2月種牌
  '0521', // 5月種牌
  '0621', // 6月種牌
  '0721', // 7月種牌
  '0821', // 8月種牌

  // 玩家2 手牌 (8張) - index 8-15
  // 注意：沒有 3 月牌，避免與場上 0341 配對
  '0131', // 1月短冊
  '0141', // 1月かす1
  '0142', // 1月かす2
  '0231', // 2月短冊
  '0241', // 2月かす1
  '0242', // 2月かす2
  '1021', // 10月種牌
  '1031', // 10月短冊

  // 場牌 (8張) - index 16-23
  '0941', // 9月かす1 - 與 0921 配對
  '0341', // 3月かす1 - 與 0311 配對
  '0441', // 4月かす1 - 翻牌雙配對目標 1
  '0442', // 4月かす2 - 翻牌雙配對目標 2
  '0531', // 5月短冊
  '0541', // 5月かす1
  '0542', // 5月かす2
  '0631', // 6月青短

  // 剩餘牌堆 (24張) - index 24-47
  '0942', // 9月かす2 - 玩家1 第 1 回合翻，無配對（0941 已被捕獲）
  '0641', // 6月かす1 - 玩家2 第 1 回合翻
  '0431', // 4月短冊 - 玩家1 第 2 回合翻，與場上 0441, 0442 雙配對
  '0642', // 6月かす2
  '0731', // 7月短冊
  '0741', // 7月かす1
  '0742', // 7月かす2
  '0811', // 8月光牌
  '0841', // 8月かす1
  '0842', // 8月かす2
  '0931', // 9月短冊
  '0331', // 3月短冊
  '0342', // 3月かす2
  '1041', // 10月かす1
  '1042', // 10月かす2
  '1111', // 11月光牌
  '1121', // 11月種牌
  '1131', // 11月短冊
  '1141', // 11月かす
  '1211', // 12月光牌
  '1241', // 12月かす1
  '1242', // 12月かす2
  '1243', // 12月かす3
  '0421', // 4月種牌
])

/**
 * 測試牌組映射表
 */
const TEST_DECKS: Record<TestDeckType, readonly string[]> = {
  triple_match: TEST_DECK_TRIPLE_MATCH,
  teshi: TEST_DECK_TESHI,
  kuttsuki: TEST_DECK_KUTTSUKI,
  field_teshi: TEST_DECK_FIELD_TESHI,
  yaku_before_selection: TEST_DECK_YAKU_BEFORE_SELECTION,
}

/**
 * 取得測試牌組
 *
 * @param type - 測試牌組類型
 * @returns 測試牌組（複製）
 */
export function getTestDeck(type: TestDeckType): string[] {
  const deck = TEST_DECKS[type]
  return [...deck]
}
